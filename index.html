<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>TM&CAM - PDF Records</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css">
  <link rel="icon" style="border-radius: 25px;" href="https://upload.wikimedia.org/wikipedia/en/f/ff/Andhra_Pradesh_Power_Generation_Company_Limited.jpg">
  <style>
/* ---------- RESTORED: Desktop + Shared styles (unchanged) ---------- */
body {
    margin: 0;
    font-family: "Segoe UI", Arial, sans-serif;
    background: #f4f4f4;
    scroll-behavior: smooth;
}

header {
    background: #232f3e;
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    position: sticky;
    top: 0;
    z-index: 1000;
}

header h1 { margin: 0; font-size: 22px; }

.nav-right { display:flex; align-items:center; gap:15px; }

.nav-right input {
    padding: 7px 10px;
    border-radius: 4px;
    border: none;
    width: 360px;
}
#passwordModal {
    z-index: 10000; /* higher than recordDetailsModal */
}
.estimate-table tbody tr {
    cursor: pointer;
}

.nav-right a {
    color:white;
    text-decoration:none;
    font-weight:600;
    transition:0.2s;
}
/* Prevent sidebar flash on load (mobile only) */
@media (max-width: 768px) {
  .left-bar {
      visibility: hidden;
      transform: translateX(-120%) !important;
      opacity: 0 !important;
  }


}
#estimates-leftbar h3 {
    margin:0 0 15px 0;
    font-size:18px;
    color:#232f3e;
    border-bottom:2px solid #ccc;
    padding-bottom:10px;
}

#estimates-leftbar button {
    display:block;
    width:100%;
    padding:10px 12px;
    margin-bottom:8px;
    border:none;
    border-radius:5px;
    background:#007bff;
    color:white;
    cursor:pointer;
    text-align:left;
    font-weight:600;
    transition:0.25s;
}

#estimates-leftbar button:hover {
    background:#0056b3;
}

#estimates-leftbar .pdf-nav-header {
    background:#ff9900 !important;
}

#estimates-leftbar .pdf-nav-header.active {
    background:#28a745 !important;
}

#estimates-leftbar .pdf-nav-content {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: translateY(-8px);
    padding-left: 15px;
    transition:
        max-height 0.45s cubic-bezier(0.25, 0.8, 0.25, 1),
        opacity 0.35s ease-in-out,
        transform 0.35s ease-out;
}

#estimates-leftbar .pdf-nav-content.active {
    max-height: 600px;
    opacity: 1;
    transform: translateY(0);
}

  .left-bar.active {
      visibility: visible !important;
      transform: translateX(0) !important;
      opacity: 1 !important;
  }
.nav-right a:hover { text-decoration:underline; transform:scale(1.05); }

/* --- Main View Tab Buttons --- */
.main-tab-btn {
    background-color: #4a5c70;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    transition: background 0.3s, transform 0.2s;
}
.main-tab-btn:hover { background-color: #5a6c80; }
.main-tab-btn.active {
    background-color: #007bff;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
}

/* Hide all views initially (fix flashing) */
#pdf-view-container,
#daily-progress-container,
#clbiodata-container {
    display: none;
}

/* Product Cards */
#pdf-grid-wrapper {
    flex: 1;
    overflow-y: auto;
    height: 100%;
    padding: 20px;
    box-sizing: border-box;
}
/* Record Details Modal */
.details-modal {
    z-index: 9000;
}

/* Password Modal ‚Äî MUST be higher */
#passwordModal {
    z-index: 10000 !important;
}

.product-grid {
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
    gap:20px;
}

/* CL Bio Data View */
.cl-view {
    width: 100%;
    padding: 20px;
    background: #f4f4f4;
}

/* Allow horizontal scrolling on mobile */
@media (max-width: 768px) {
  #pdf-grid-wrapper {
    overflow-x: auto !important;
    overflow-y: auto;
    
  }

  table {
    min-width: 638px; /* or whatever width needed */
  }

  .right-panel {
    overflow-x: auto !important;
  }
}

    
#clBioGrid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 20px;
    width: 100%;
}
/* FIX: Prevent header row from turning white on hover */
.estimate-table thead tr:hover,
.estimate-table thead th:hover {
    background: #007bff !important;
    color: white !important;
}

@media (max-width: 768px) {
    .nav-right {
        justify-content: flex-end;
    }
    .search-wrapper {
        flex-grow: 1;
    }
}

/* CL Cards */
.cl-card {
    background: #ffffff;
    border-radius: 14px;
    padding: 18px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.12);
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: left;
    transition: 0.25s;
}
.cl-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}
.cl-photo {
    width: 110px;
    height: 110px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 12px;
    border: 2px solid #e0e0e0;
}
.cl-name {
    font-size: 1.2rem;
    font-weight: 700;
    color: #232f3e;
    margin-bottom: 10px;
}
.cl-info-box p {
    margin: 4px 0;
    width: 100%;
    font-size: 0.95rem;
    color: #333;
}
.cl-info-box p b { color: #000; }

/* Product */
.product {
    background:white;
    padding:15px;
    border-radius:10px;
    box-shadow:0 2px 6px rgba(0,0,0,0.15);
    transition: transform 0.3s, box-shadow 0.3s;
    display:flex;
    flex-direction:column;
    height:100%;
    box-sizing:border-box;
}
.product:hover { transform:translateY(-4px); box-shadow:0 4px 12px rgba(0,0,0,0.2); }
.product img {
    width:100%;
    height:160px;
    object-fit:contain;
    border-radius:6px;
    padding:10px;
}

.product-info { flex-grow:1; }
.product-info h3 {
    text-align:left;
    font-size:1.1rem;
    color:#232f3e;
    line-height:1.4;
}
.product-info p {
    text-align:left;
    font-size:0.9rem;
    margin:8px 0;
}

/* ========================= DARK MODE ========================== */
body.dark-mode { background:#121212 !important; color:#fff !important; }
header.dark-mode { background:#0d0d0d !important; }
header.dark-mode input {
    background:#1e1e1e !important;
    color:white !important;
    border:1px solid #555 !important;
}
header.dark-mode input::placeholder { color:#bbb !important; }
.left-bar.dark-mode { background:#1a1a1a !important; color:white !important; }
.product.dark-mode { background:#1f1f1f !important; border:1px solid #333 !important; color:white !important; }
.product.dark-mode .view-btn { background:#0066ff !important; }
#modalContent.dark-mode { background:#1f1f1f !important; color:#fff !important; }
.dropdown-menu.dark-mode { background:#0f0f0f !important; border-color:#333 !important; }
.dropdown-menu.dark-mode a:hover { background:#222 !important; }

/* Burger Menu */
.burger-menu {
    font-size:26px;
    cursor:pointer;
    margin-right:12px;
    padding:5px 10px;
    border-radius:6px;
    transition:background 0.2s;
    display:block;
}
.burger-menu:hover { background:rgba(255,255,255,0.15); }

/* Dropdown */
.dropdown-menu {
    position:absolute;
    top:70px;
    right:10px;
    background:#232f3e;
    border-radius:8px;
    width:220px;
    box-shadow:0 4px 12px rgba(0,0,0,0.3);
    display:none;
    flex-direction:column;
    padding:10px 0;
    z-index:2000;
    animation:fadeIn 0.25s ease;
}
.dropdown-menu a {
    color:white;
    padding:10px 20px;
    text-decoration:none;
    font-size:15px;
    display:block;
}
.dropdown-menu a:hover { background:#20bbd8; }

/* View button */
.product .view-btn {
    margin-top:auto;
    width:100%;
    padding:8px 14px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
    transition:0.2s;
}

/* MOBILE BURGER MENU */
@media (max-width: 768px) {
    .dropdown-menu {
        position: fixed !important;
        right: 0 !important;
        top: 156px !important;
        width: 70% !important;
        transform: translateX(100%);
        transition: transform 0.35s ease-in-out;
        display: flex !important;
        flex-direction: column;
    }

    .dropdown-menu.active {
        transform: translateX(0%);
    }
}
    
.view-btn { background:#007bff; color:white; }

/* Sub Nav Bar */
#subNavBar {
    width:100%;
    background:#fff;
    padding:12px 0;
    display:flex;
    justify-content:center;
    gap:18px;
    border-bottom:1px solid #ddd;
    position:sticky;
    top: calc(var(--header-height, 85px));
    z-index:900;
}


    
.subnav-btn {
    background:#4a5c70;
    color:white;
    border:none;
    padding:8px 20px;
    border-radius:25px;
    font-size:15px;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s;
}
.subnav-btn:hover { background:#007bff; transform:scale(1.08); }
.subnav-btn.active {
    background:#007bff;
    color:#fff;
    box-shadow:inset 0px 2px 6px rgba(0,0,0,0.2);
}
.menu-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.4);
    display: none;
    z-index: 1500;
}

.menu-overlay.active {
    display: block;
}

.dropdown-menu {
    z-index: 1600;
    margin-top: 10px;
}

/* Modal */
#productModal {
    display:none;
    position:fixed;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.6);
    justify-content:center;
    align-items:center;
    z-index:1001;
    opacity:0;
    transition:opacity 0.3s ease;
}
#productModal.active { display:flex; opacity:1; }

#modalContent {
    background: white;
    border-radius: 10px;
    width: 239%;
    max-width: 1253px;
    /* height: 90vh; */
    padding: 10px;
    position: relative;
    display: flex;
    flex-direction: column;
}

#modalContent iframe {
    flex:1;
    width:100%;
    border:none;
    border-radius:6px;
    min-height:73vh;
}

#closeModal {
    position:absolute;
    top:10px;
    right:15px;
    cursor:pointer;
    font-size:22px;
    color:red;
    z-index:1002;
}

/* Scroll to top */
#scrollTopBtn {
    position:fixed;
    bottom:25px;
    right:25px;
    background:#232f3e;
    color:white;
    padding:10px 14px;
    border-radius:50%;
    font-size:18px;
    cursor:pointer;
    display:none;
    transition:0.2s;
    z-index:999;
}
#scrollTopBtn:hover { transform:scale(1.15); background:#ff9900; }
#passwordModal {
    backdrop-filter: blur(4px);
}

footer {
    background:#232f3e;
    color:white;
    text-align:center;
    padding:20px;
    margin-top:40px;
    font-size:14px;
}

/* Main Views */
main {
    width:100%;
    min-height:calc(100vh - 67px);
}

.main-view {
    width:100%;
    min-height: calc(100vh - 70px);
    display:none;
    flex-direction:row;
    background:white;
}
.main-view.active { display:flex; }

/* Left bar */
.left-bar {
    width:220px;
    background:#f0f4f8;
    border-right:1px solid #ccc;
    overflow-y:auto;
    padding:15px;
    box-sizing:border-box;
    position: sticky;
    top: 110px;
    height: auto;
}
.left-bar h3 {
    margin:0 0 15px 0;
    font-size:18px;
    color:#232f3e;
    border-bottom:2px solid #ccc;
    padding-bottom:10px;
}
.left-bar {
    transition: transform 0.35s ease, opacity 0.25s ease-in-out !important;
    will-change: transform, opacity;
}

/* Right panel */
.right-panel {
    flex: 1;
    overflow-y: auto;     /* allows scrolling */
    overflow-x: hidden;   /* prevents blocking dropdown */
    height: auto;
    display: flex;
    flex-direction: column;
    position: relative;
    z-index: 1;
  padding: 20px;
}

    /* Desktop restore */
@media (min-width: 769px) {
    .left-bar {
        position: sticky !important;
        transform: none !important;
        opacity: 1 !important;
        z-index: 1 !important;
    }

    #mobileFilterBtn,
    #mobileEstFilterBtn,
    #mobileDailyFilterBtn {
        display: none !important;
    }
}
#menuOverlay {
    z-index: 4000 !important;
}

.dropdown-menu {
    z-index: 5000 !important;
}

/* ---- ESTIMATE TABLE MATCH INDENT TABLE ---- */
.estimate-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border: 1px solid #d0d7de;
    border-radius: 8px;
    overflow: hidden;
}

.estimate-table thead tr {
    background: #007bff;
    color: white;
}

.estimate-table th {
    padding: 10px;
    font-size: 15px;
    border-right: 1px solid #ddd;
    text-align: left;
}

.estimate-table td {
    padding: 10px;
    border-bottom: 1px solid #e5e5e5;
    border-right: 1px solid #f0f0f0;
    font-size: 14px;
}

.estimate-table tr:hover {
    background: #f0f7ff;
}

.estimate-table td.amount {
    font-weight: bold;
    color: green;
}

.view-btn {
    background:#007bff;
    color:white;
    padding:6px 12px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    font-weight:bold;
}

.view-btn:hover {
    background:#0056b3;
}

    
.dropdown-menu {
    position: absolute;
    z-index: 5000 !important;
}
.menu-overlay.active {
    z-index: 4000 !important;
}

/* PDF NAV BUTTONS */
#pdf-nav-bar button {
    display:block;
    width:100%;
    padding:10px 12px;
    margin-bottom:8px;
    border:none;
    border-radius:5px;
    background:#007bff;
    color:white;
    cursor:pointer;
    text-align:left;
    font-weight:600;
}

#pdf-nav-bar .pdf-nav-header { 
    background:#ff9900; 
    transition: background 0.2s ease, transform 0.2s ease;
}
#pdf-nav-bar .pdf-nav-header:active {
    transform: scale(0.96);
}

#pdf-nav-bar button.active { 
    background:#28a745; 
}

/* -------------------------
   SMOOTH DROPDOWN ANIMATION
--------------------------- */
#pdf-nav-bar .pdf-nav-content {
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: translateY(-8px);
    padding-left: 15px;

    transition:
        max-height 0.45s cubic-bezier(0.25, 0.8, 0.25, 1),
        opacity 0.35s ease-in-out,
        transform 0.35s ease-out;
}

/* When active (open state) */
#pdf-nav-bar .pdf-nav-content.active {
    max-height: 600px;      /* enough height */
    opacity: 1;
    transform: translateY(0);
}

/* Daily Progress */
.date-list-item {
    display:block;
    width:100%;
    padding:10px;
    margin-bottom:5px;
    border:none;
    border-radius:5px;
    background:#007bff;
    color:white;
    cursor:pointer;
    text-align:left;
    font-weight:600;
}
.date-list-item.active { background:#28a745; }

/* Snapshot */
#inlineSnapshotFrame { flex:1; padding:20px; overflow:auto; }
#inlineSnapshotFrame table { width:100%; border-collapse:collapse; }
#inlineSnapshotFrame th, #inlineSnapshotFrame td {
    border:1px solid #ccc;
    padding:8px;
    text-align:left;
    white-space:normal;
}

/* MOBILE VIEW */
@media (max-width: 768px) {
    main { flex-direction:column !important; overflow:visible !important; }

    header { flex-wrap:wrap; }
    header h1 { font-size:16px; }

    .nav-right { width:100%; flex-wrap:wrap; gap:8px; margin-top:10px; }
    .nav-right input { width:100%; }

    #mobileFilterBtn, #mobileDailyFilterBtn {
        display:none;
        width:95%;
        margin:10px auto;
        padding:12px;
        border-radius:6px;
        font-size:16px;
        font-weight:bold;
    }

    .product-grid {
        grid-template-columns:1fr !important;
        gap:18px;
        padding:10px;
    }

    .product img { height:140px !important; }

/* --- Smooth Slide + Fade for Sidebar --- */
.left-bar {
    position: fixed;
    top: 68px;
    left: 0;
    width: 220px;
    background: #f0f4f8;
    height: calc(100vh - 68px);
    padding: 12px;
    transform: translateX(-120%);
    
    opacity: 0;
    transition:
        transform 0.55s cubic-bezier(0.16, 1, 0.3, 1),
        opacity 0.35s ease-in-out;
  
    z-index: 1500;
    overflow-y: auto;
}

/* Sidebar becomes visible */
.left-bar.active {
    transform: translateX(0);
    opacity: 1;
}


    #modalContent {
        width:100% !important;
        height:calc(100vh - 56px) !important;
        border-radius:0 !important;
        padding:0 !important;
    }
    #modalContent iframe { height:100% !important; }

    #closeModal {
        position:fixed;
        top:14px;
        right:14px;
        width:48px;
        height:48px;
        border-radius:10px;
        background:white;
        font-size:22px;
        z-index:2002;
    }

    #inlineSnapshotFrame { padding:10px; }
    table th, table td { font-size:0.75rem !important; padding:6px !important; }
}
    /* Left-bar smooth fade + slide-in animation */
.left-bar {
    animation: leftbarFade 0.35s ease;
}

.right-bar-header { display:flex; justify-content:space-between; align-items:center; padding: 10px 20px; border-bottom: 1px solid #ccc; background: #f9f9f9; } .right-bar-header h3 { margin: 0; color: #232f3e; } .right-bar-header button { background: #007bff; color:white; border:none; border-radius: 5px; padding: 8px 14px; font-weight: bold; cursor: pointer; } .right-bar-header button:hover { background: #0056b3; }

@keyframes leftbarFade {
    from { opacity: 0; transform: translateX(-10px); }
    to { opacity: 1; transform: translateX(0); }
}
/* Daily Progress date buttons restore animations */
.date-list-item {
    transition: all 0.25s ease-in-out;
}

.date-list-item:hover {
    background: #0056b3;
    transform: translateX(5px);
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
}
/* Print button style */
#inlinePrintBtn {
    background: #007bff;
    color: white;
    padding: 8px 14px;
    border-radius: 6px;
    font-weight: bold;
    border: none;
    cursor: pointer;
    margin-bottom: 10px;
    transition: 0.25s;
}

#inlinePrintBtn:hover, #printBtn:hover, button#print:hover {
    background: #0056b3;
    transform: scale(1.05);
}

.product {
    animation: fadeSlideUp 0.45s ease forwards;
    opacity: 0;
}
.cl-card {
    animation: fadeSlideUp 0.45s ease forwards;
    opacity: 0;
}

    
    @keyframes fadeSlideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
.product:nth-child(1),
.cl-card:nth-child(1) { animation-delay: 0.05s; }
.product:nth-child(2),
.cl-card:nth-child(2) { animation-delay: 0.10s; }
.product:nth-child(3),
.cl-card:nth-child(3) { animation-delay: 0.15s; }
.product:nth-child(4),
.cl-card:nth-child(4) { animation-delay: 0.20s; }
.product:nth-child(5),
.cl-card:nth-child(5) { animation-delay: 0.25s; }
.product:nth-child(6),
.cl-card:nth-child(6) { animation-delay: 0.30s; }

/* PDF sidebar open/close animation */

/* Fade + Slide Up */
@keyframes listFadeUp {
    0% {
        opacity: 0;
        transform: translateY(10px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

.list-row {
    animation: listFadeUp 0.45s ease forwards;
    opacity: 0;
}
@keyframes tableEnter {
    0% {
        opacity: 0;
        transform: scale(0.96);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

.table-animate {
    animation: tableEnter 0.35s ease-out;
}
.list-row:hover {
    background: #f7faff;
    transition: 0.25s ease;
    box-shadow: inset 0 0 0 9999px rgba(0, 123, 255, 0.05);
}
@keyframes clickFlash {
    0% { background: #cfe8ff; }
    100% { background: transparent; }
}
/* Search button (mobile) */
.search-wrapper {
    display: flex;
    align-items: center;
    gap: 8px;
}

.search-btn {
    background: #007bff;
    border: none;
    padding: 8px 10px;
    border-radius: 6px;
    color: white;
    font-size: 18px;
    cursor: pointer;
    display: none; /* hidden on desktop */
}

.search-field {
    width: 360px;
    transition: 0.3s;
}
@media (max-width: 768px) {
    .nav-right a[onclick="openPasswordModal()"] {
        display: none !important;
    }
}
@media (max-width: 768px) {
    .nav-right {
        gap: 6px !important;
        width: 100%;
    }
    .search-wrapper {
        flex-grow: 1;
    }
}
@media (min-width: 769px) {
    .left-bar {
        position: sticky !important;
        transform: none !important;
        opacity: 1 !important;
        z-index: 2 !important;
    }

    #mobileFilterBtn,
    #mobileDailyFilterBtn {
        display: none !important;
    }
}

/* Mobile: hide search bar by default */
@media (max-width: 768px) {
    .search-field {
        width: 0;
        opacity: 0;
        padding: 0;
        border: none;
    }

    .search-field.active {
        width: 100%;
        opacity: 1;
        padding: 7px 10px;
        border-radius: 6px;
        border: 1px solid #999;
    }

    .search-btn {
        display: block;
    }
}
/* Modern Circle Loader */
.loader {
  width: 48px;
  height: 48px;
  border: 5px solid #ddd;
  border-top-color: #007bff;
  border-radius: 50%;
animation: spinLoader 0.9s linear infinite; /* ‚úÖ FIX */
  margin: 30px auto;
}

@keyframes spinLoader {
  to {
    transform: rotate(360deg);
  }
}
/* ================================
   RECORD DETAILS MODAL ‚Äì CLEAN UI
================================ */

/* Overlay */
.details-modal {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.55);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9000;
}

.details-modal.active {
    display: flex;
}

/* Modal box */
.details-box {
    background: #ffffff;
    width: 90%;
    max-width: 720px;
    border-radius: 14px;
    padding: 22px 26px;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.25);
    animation: scaleFadeIn 0.35s ease;
    max-height: 90vh;
    overflow-y: auto;
}

/* Title */
.details-title {
    margin: 0 0 18px;
    text-align: center;
    font-size: 22px;
    font-weight: 700;
    color: #232f3e;
    border-bottom: 2px solid #e5e5e5;
    padding-bottom: 10px;
}

/* Grid layout */
.details-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px 22px;
}

/* Label */
.details-grid b {
    display: block;
    font-size: 12px;
    font-weight: 600;
    color: #555;
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.04em;
}

/* Value box */
.details-grid p {
    margin: 0;
    padding: 9px 12px;
    background: #f4f7fb;
    border-radius: 8px;
    border: 1px solid #dde2ee;
    font-size: 14px;
    color: #222;
    word-break: break-word;
}

/* Highlight amount */
.details-grid p:has(:is(.amount)) {
    font-weight: bold;
    color: #1a7f37;
}

/* Buttons row */
.details-box .view-btn {
    min-width: 120px;
    padding: 8px 14px;
    font-size: 14px;
    border-radius: 6px;
    cursor: pointer;
}

/* Close button */
.close-details {
    position: sticky;
    /* top: 14px; */
    /* right: 260px; */
    left: 100%;
    background: #dc3545;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: bold;
}

.close-details:hover {
    background: #b02a37;
}

/* Entry animation */
@keyframes scaleFadeIn {
    from {
        opacity: 0;
        transform: scale(0.95);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

/* ================================
   MOBILE OPTIMIZATION
================================ */
@media (max-width: 600px) {

    .details-box {
        width: 100%;
        height: 100vh;
        border-radius: 0;
        padding: 18px;
    }

    .details-title {
        font-size: 18px;
    }

    .details-grid {
        grid-template-columns: 1fr;
    }

    .details-grid p {
        font-size: 13px;
        padding: 8px 10px;
    }

    .details-box .view-btn {
        width: 100%;
        margin-top: 10px;
    }
}

#estimates-leftbar {
    width: 220px;
    padding: 15px;
    background: #f0f4f8;
    border-right: 1px solid #ccc;
    box-sizing: border-box;
}

#estimates-leftbar h3 {
    margin-bottom: 15px;
    font-size: 18px;
    border-bottom: 2px solid #ccc;
    padding-bottom: 10px;
    color: #232f3e;
}

#estimates-leftbar button {
    display: block;
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 8px;
    border: none;
    border-radius: 5px;
    background: #ff9900;
    color: white;
    cursor: pointer;
    font-weight: 600;
    text-align: left;
    transition: 0.25s;
}

#estimates-leftbar button:hover {
    background: #d98200;
}

#estimates-leftbar button.active {
    background: #28a745 !important;
}

#estimates-leftbar .pdf-nav-content {
    padding-left: 15px;
}
#estimates-leftbar {
    display: block !important;
    visibility: visible !important;
}
#estimatesContainer {
    flex-direction: row;
    width: 100%;
    height: auto;
}

#estimatesGrid {
    flex: 1;
    gap: 20px;
}

@media (max-width: 768px) {
    .products-grid {
        grid-template-columns: 1fr !important;
        gap: 18px;
        padding: 10px;
    }
}
  /* Mobile Optimization for Subnav Buttons */
@media (max-width: 768px) {
 .subnav-btn {
        font-size: 0.65rem;
        padding: 5px 8px;
        border-radius: 10px;
        margin: 0 4px;
        display: flex;
        align-items: center;
        justify-content: center;
       
  }

  .subnav-btn img,
  .subnav-btn i {
    width: 16px;
    height: 16px;            /* Reduce icon size if present */
  }
}
  @media (max-width: 768px) {
    #mobileFilterBtn, #mobileEstFilterBtn, #mobileDailyFilterBtn {
        display: none;
        width: 95%;
        margin: 10px auto;
        padding: 12px;
        border-radius: 6px;
        font-size: 16px;
        font-weight: bold;
    }
}
    .floating-btn {
    position: fixed;
    right: 16px;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: #232f3e;
    color: white;
    border: none;
    font-size: 20px;
    cursor: pointer;
    display: none;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    z-index: 2000;
    transition: opacity 0.3s ease, transform 0.25s ease;
}

#goTopBtn { bottom: 80px; }
#goBottomBtn { bottom: 20px; }

.floating-btn:hover {
    transform: scale(1.12);
    background: #ff9900;
}

</style>

</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:12px">
      <img src="https://upload.wikimedia.org/wikipedia/en/f/ff/Andhra_Pradesh_Power_Generation_Company_Limited.jpg"
           alt="logo" style="height:42px;border-radius:4px;background:#fff;padding:2px">
      <h1>TM&CAM - PDF Records</h1>
    </div>

    <div class="nav-right">
      <div class="search-wrapper">
    <button id="searchIconBtn" onclick="toggleSearchBar()" class="search-btn">üîç</button>
    <input id="searchInput" class="search-field" placeholder="Search by Work, PR No, or Send To..." />
</div>
      <a href="javascript:void(0)" onclick="openPasswordModal()" title="Add New Record">‚ûï Add Record</a>
      <a href="login.html" id="loginLink" title="Login Page">üîê Login</a>
      <div class="burger-menu" onclick="toggleMenu()">‚ò∞</div>

<!-- Dropdown Menu -->
<div id="dropdownMenu" class="dropdown-menu">
  <a onclick="openPasswordModal()">‚ûï Add Record</a>
    <a onclick="window.location.href='test.html'">üìÑ Imprest Covering letter</a>
    <!-- Add more menu items here -->
    <a href="settings.html">‚öô Settings</a>
    <a href="#">üìû Contact</a>
</div>
    </div>
  </header>

  <div id="subNavBar">
  <button class="subnav-btn" onclick="showMainView('pdf')">üìÑ All Indents</button>
    <button class="subnav-btn" onclick="showMainView('estimates')">üìò Estimates</button>
  <button class="subnav-btn" onclick="showMainView('progress')">üìÖ Daily Progress</button>
  <button class="subnav-btn" onclick="showMainView('clbiodata')">üë• CL's Bio Data</button>
   <button class="subnav-btn" onclick="showMainView('files')">üìÅ File Transfer</button>

</div>

  <!-- Mobile toggles (visible on mobile only by CSS) -->
  
  <button id="mobileFilterBtn" style="display:none;">üìÇ Filters</button>
<button id="mobileEstFilterBtn" style="display:none;">üìò Estimate Filters</button>
<button id="mobileDailyFilterBtn" style="display:none;">üìÇ Daily Filters</button>


  <main>
    <!-- PDF View -->
    <div id="pdf-view-container" class="main-view">
      <aside id="pdf-nav-bar" class="left-bar" aria-hidden="true">
        <h3>Filter Indents</h3>
        <button class="pdf-nav-btn show-all active" onclick="showAllPDFs(this)">üìÇ Show All</button>
      </aside>

      <section id="pdf-grid-wrapper" class="right-panel">
         <h1 id="pdfHeader" style="margin: 10px;text-align: center;">üìÑ All Stage-V Indents</h1>
        <div id="pdf-loader" class="loader"></div>
        <div class="product-grid" id="product-list" style="display:none">
          
        </div>
      </section>
    </div>

<!-- ESTIMATES VIEW -->

<div id="estimatesContainer" class="main-view">

    <aside id="estimates-leftbar" class="left-bar">
        <div class="estimates-content">
            <h2>Estimate Records</h2>
        </div>
    </aside>
<section id="estimates-right-panel" class="right-panel">
  <h1 id="estHeader" style="margin: 10px; text-align: center;">üìò All Stage-V Estimates</h1>
  <div id="est-loader" class="loader"></div>
    <div id="estimatesGrid" class="products-grid" style="display: grid; grid-template-columns: repeat(4, minmax(240px, 1fr));">
    </div>
</section>
</div>  <!-- Only ONE closing div is correct -->

    
    <!-- Daily Progress view -->
    <div id="daily-progress-container" class="main-view">
      <aside id="inlineLeftBar" class="left-bar" aria-hidden="true">
        <h3>Daily Progress</h3>
        <div id="inlineDateList"><div id="loader" class="loader"></div><p>Loading dates...</p></div>
      </aside>

      <section id="inlineRightBar" class="right-panel">
        <div class="right-bar-header" style="padding:12px 16px;border-bottom:1px solid #eee;background:#fff">
          <h3 id="inlineSnapshotTitle" style="margin:0">Select a date to view</h3>
          <button id="inlinePrintBtn" onclick="printDailyProgress()" style="display:none">üñ®Ô∏è Print</button>
        </div>
        <div id="inlineSnapshotFrame" style="flex:1;padding:20px">
          <p style="color:#555">Please select a date from the list on the left.</p>
        </div>
      </section>
    </div>
    <!-- CL Bio Data View -->
<div id="clbiodata-container" class="cl-view">
  <div style="padding:20px; width:100%;">
    <h2>üë• CL's Bio Data</h2>

    <div id="clBioGrid" style="display:grid; grid-template-columns:repeat(auto-fill,minmax(260px,1fr)); gap:20px; margin-top:20px;"></div>
  </div>
</div>
<!-- FILE TRANSFER VIEW -->
<div id="file-transfer-container" class="main-view">
  <section class="right-panel">

    <div style="display:flex;justify-content:space-between;align-items:center;">
      <h1>üìÅ File Transfer</h1>
      <div id="fileLoginStatus" style="font-weight:600;color:#198754;"></div>
    </div>

    <div style="margin:15px 0;">
      <input type="file" id="fileInput">
      <button class="view-btn" onclick="uploadFile()">‚¨Ü Upload</button>
    </div>

    <table class="estimate-table">
      <thead>
        <tr>
          <th>File</th>
          <th>Size</th>
          <th>Uploaded</th>
          <th>Expires</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="fileList"></tbody>
    </table>

  </section>
</div>


  </main>

  <!-- PDF Modal -->
  <div id="productModal" aria-hidden="true" role="dialog" aria-modal="true">
    <div id="modalContent" role="document">
      <div id="modalHeader">
        <div style="align-items:center;gap:12px">
          <h2 id="modalName">Title</h2>
          <p id="modalPR" style="-webkit-text-stroke-width: thick;">PR No:</p>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <!-- toolbar (mobile) -->
          <div id="modalToolbar" style="display:none">
            <button id="openInNewBtn" title="Open PDF in new tab">Open</button>
            <button id="downloadBtn" title="Download PDF">Download</button>
          </div>
          <button id="closeModal" aria-label="Close PDF">‚ùå</button>
        </div>
      </div>

      <!-- small drag-handle (mobile look) -->
      <div class="drag-handle" style="display:none"></div>

      <div id="modalBody">
        <iframe id="pdfFrame" title="PDF viewer" src="about:blank"></iframe>
      </div>
    </div>
  </div>

  <div id="remarksModal" style="display:none;position:fixed;top:10%;left:50%;transform:translateX(-50%);background:white;padding:20px;width:90%;max-width:500px;z-index:999;">
  <h3>PR Remarks</h3>
  <div id="remarksList" style="max-height:200px;overflow:auto;"></div>

  <textarea id="newRemark" placeholder="Enter remark" style="width:100%;margin-top:10px;"></textarea>

  <button onclick="saveRemark()">Save</button>
  <button onclick="closeRemarks()">Close</button>
</div>

<!-- ======================================================
     FULL RECORD DETAILS MODAL (AUTO FILLS ALL DB FIELDS)
====================================================== -->
<div id="recordDetailsModal" class="details-modal">
  <div class="details-box">
    <button class="close-details" onclick="closeRecordDetails()">‚úñ</button>

    <h2 class="details-title">Record Details</h2>

    <div id="detailsGrid" class="details-grid"></div>

    <div style="display:flex;justify-content:space-between;margin-top:18px">
      <button class="view-btn" onclick="printRecordDetails()">üñ®Ô∏è Print</button>
      <button class="view-btn" onclick="openAddRecordFromDetails()">
    ‚ûï Add Record
</button>

    </div>
  </div>
</div>

<!-- Password modal (unchanged) -->
  <div id="passwordModal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:1400">
    <div id="passwordBox" style="background:#fff;padding:20px;border-radius:12px;min-width:280px;max-width:360px">
      <h3 style="margin-top: 0px;margin-bottom: 25px;text-align: center;">üîê Enter Admin Credentials</h3>
      <input id="usernameInput" placeholder="Username" style="width:100%;padding:8px;margin-bottom: 15px;border-radius: 10px;">
      <input id="passwordInput" type="password" placeholder="Password" style="width:100%;padding:8px;margin-bottom: 15px;border-radius: 10px;">
      <div style="display:flex;gap:8px;justify-content:flex-end">
        <button onclick="verifyPassword()" style="padding:8px 12px;border:0;border-radius:6px;color: #ffffff;background-color: #378cdd;cursor: pointer;">Submit</button>
        <button onclick="closePasswordModal()" style="background:#dc3545;color:#fff;padding:8px 12px;border:0;border-radius:6px;cursor: pointer;">Cancel</button>
      </div>
    </div>
  </div>
<button id="goBottomBtn" class="floating-btn">‚¨áÔ∏è</button>
<button id="goTopBtn" class="floating-btn">‚¨ÜÔ∏è</button>

  <footer>
    <p>üîó Contact | üõ†Ô∏è Help | üîê Privacy</p>
    <p>¬© 2025 MyWeb. Built by Tarun</p>
    <p id="visitCounter" style="margin-top:8px; font-size:14px; opacity:0.8;"></p>

  </footer>


  <button id="scrollTopBtn" title="Scroll to Top" style="position:fixed;right:18px;bottom:18px;display:none;background:var(--dark);color:#fff;border-radius:50%;border:0;padding:10px;z-index:2000">‚¨ÜÔ∏è</button>


  <script>
    // Server URL unchanged
    const SERVER_URL = "https://nttps-backend.onrender.com";
    let allRecords = [];
    const userRole = localStorage.getItem("role") || "viewer";

    

    // DOM refs
    const pdfView = document.getElementById("pdf-view-container");
    const clbiodata = document.getElementById("clbiodata-container");
    const progressView = document.getElementById("daily-progress-container");
    const viewTabPdf = document.getElementById("viewTabPdf");
    const viewTabProgress = document.getElementById("viewTabProgress");
    const pdfNav = document.getElementById("pdf-nav-bar");
    const estimatesContainer = document.getElementById("estimatesContainer");
    const container = document.getElementById("estimatesGrid");
    const mobileFilterBtn = document.getElementById("mobileFilterBtn");
    const mobileDailyFilterBtn = document.getElementById("mobileDailyFilterBtn");
    const mobileEstFilterBtn = document.getElementById("mobileEstFilterBtn");
    const estRightPanel = document.getElementById("estimates-right-panel");

let pendingUpload = false;

    
window.showMainView = function(viewName){

    document.querySelectorAll(".subnav-btn").forEach(btn => btn.classList.remove("active"));
  document.getElementById("file-transfer-container").style.display = "none";

  pdfView.style.display = "none";
  progressView.style.display = "none";
  clbiodata.style.display = "none";
  estimatesContainer.style.display = "none";


// Hide all mobile filter buttons first
  mobileFilterBtn.style.display = "none";
  mobileEstFilterBtn.style.display = "none";
  mobileDailyFilterBtn.style.display = "none";
  
  if (viewName === "pdf") {
      pdfView.style.display = "flex";
      mobileFilterBtn.style.display = "block";
       scrollToTop();
      document.getElementById("pdfHeader").textContent = "üìÑ All Stage-V Indents";  // RESET every time
      document.querySelector("#subNavBar button:nth-child(1)").classList.add("active");
  }

// Always close modal when switching views
if (productModal.classList.contains("active")) {
    closeModal();
}


  
  if (viewName === "estimates") {
      estimatesContainer.style.display = "flex";
      mobileEstFilterBtn.style.display = "block";
    scrollToTop();
      document.getElementById("estHeader").textContent = "üìò All Stage-V Estimates";
      document.querySelector("#subNavBar button:nth-child(2)").classList.add("active");
  }

  if (viewName === "progress") {
      progressView.style.display = "flex";
      mobileDailyFilterBtn.style.display = "block";
    scrollToTop();
      document.querySelector("#subNavBar button:nth-child(3)").classList.add("active");
  }

  if (viewName === "clbiodata") {
      clbiodata.style.display = "block";
    scrollToTop();
      document.querySelector("#subNavBar button:nth-child(4)").classList.add("active");
      renderCLBioData();
  }
  if (viewName === "files") {
  document.getElementById("file-transfer-container").style.display = "flex";
  document.querySelector("#subNavBar button:nth-child(5)").classList.add("active");
  scrollToTop();
    loadFiles();               // ‚úÖ REQUIRED
  updateFileLoginStatus();
}

};


function collapseAllDropdowns(sidebarId) {
    const sidebar = document.getElementById(sidebarId);
    if (!sidebar) return;

    // Collapse every section
    sidebar.querySelectorAll(".pdf-nav-header").forEach(h => h.classList.remove("active"));
    sidebar.querySelectorAll(".pdf-nav-content").forEach(c => c.classList.remove("active"));

    // Remove button active states
    sidebar.querySelectorAll("button").forEach(b => b.classList.remove("active"));
}

    
    // Set initial mobile buttons visibility depending on width
    function updateMobileButtons(){
      if(window.innerWidth <= 768){
        mobileFilterBtn.style.display = "block";
        mobileEstFilterBtn.style.display = "block";
        mobileDailyFilterBtn.style.display = "block";
      } else {
        mobileFilterBtn.style.display = "none";
        mobileEstFilterBtn.style.display = "none";
        mobileDailyFilterBtn.style.display = "none";
        // ensure sidebars visible on desktop
        pdfNav.classList.remove("active");
        document.getElementById("inlineLeftBar")?.classList?.remove("active");
      }
    }
    window.addEventListener("resize", updateMobileButtons);
    updateMobileButtons();

    // Load records
    async function loadRecords(){
      try{
        const res = await fetch(`${SERVER_URL}/records`);
        allRecords = await res.json();
        allEstimates = allRecords.filter(r => (r.recordType || "").toLowerCase() === "estimate");
       

      }catch(e){
        console.error("Failed to load records", e);
        allRecords = []; // fallback
      } finally {
    document.getElementById("pdf-loader").style.display = "none";
    document.getElementById("product-list").style.display = "grid";

    renderRecords(allRecords);
    buildDynamicDivisionFilters();   // ‚¨ÖÔ∏è ADD HERE
    buildEstimateFilters();
    showMainView('pdf');
}
    }

    // summary helper
    function summarize(text){
      if(!text) return "Untitled Record";
      let clean = text.replace(/Indent for (the )?Procurement of /i, "");
      clean = clean.charAt(0).toUpperCase() + clean.slice(1);
      if(clean.includes("3-Way Temperature Regulators")) return "3-Way Temperature Regulators # DN50 & DN65";
      if(clean.length > 100) clean = clean.substring(0,100) + "...";
      return clean;
    }
    
let lastRenderedCount = null;
    // render records
    function renderRecords(records) {

      if (records.length === lastRenderedCount) return;
    lastRenderedCount = records.length;
      
    const container = document.getElementById("product-list");
    const listEnabled = localStorage.getItem("listView") === "true";




    // filtering & accordion
    function clearPdfNavActive(){
      pdfNav.querySelectorAll('button').forEach(b=>b.classList.remove('active'));
    }
    window.filterRecords = function(subDiv, type, btn){

    document.getElementById("pdfHeader").textContent = `üìÑ All ${subDiv} Indents`;  // <-- NEW

    clearPdfNavActive();
    if(btn) btn.classList.add('active');

    const header = btn?.closest?.('.pdf-nav-section')?.querySelector('.pdf-nav-header');
    if(header) header.classList.add('active');

    const filtered = allRecords.filter(r => r.subDivision === subDiv && r.recordType === type);
    renderRecords(filtered);

    if(window.innerWidth <= 768){
        pdfNav.classList.remove('active');
    }
};

    window.togglePdfNav = function(headerButton, event) {
    if (event && event.target !== headerButton) return; // prevent accidental opens


    const sidebar = headerButton.closest(".left-bar");

    // Close all
    sidebar.querySelectorAll(".pdf-nav-header").forEach(h => {
        if (h !== headerButton) h.classList.remove("active");
    });
    sidebar.querySelectorAll(".pdf-nav-content").forEach(c => {
        if (c !== headerButton.nextElementSibling) c.classList.remove("active");
    });

    // Toggle only this section
    headerButton.classList.toggle("active");
    const content = headerButton.nextElementSibling;
    if (content) content.classList.toggle("active");
};

    window.showAllPDFs = function (btn) {
    document.getElementById("pdfHeader").textContent = "üìÑ All Stage-V Indents";

    collapseAllDropdowns("pdf-nav-bar");   // NEW

    if (btn) btn.classList.add("active");

    renderRecords(allRecords);

    if (window.innerWidth <= 768) {
        pdfNav.classList.remove("active");
    }
};



      
    // ========= üü¶ LIST VIEW MODE ========
    // ========= üü¶ LIST VIEW MODE ========
if (listEnabled) {
    container.style.display = "block";
    container.innerHTML = `
        <table class="table-animate" style="
    width:100%;
    border:1px solid #ccc;
    border-collapse:collapse;
    background:white;
    overflow:hidden;
    border:1px solid #ccc;  /* outer border */">
            <thead>
                <tr style="background:#007bff;color:white;">
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Logo</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Name</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">PR No</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Division</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Type</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Amount</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Send To</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Status</th>
                    <th style="padding:10px;border:1px solid #ddd;background:#007bff;color:white;">Action</th>        
                </tr>
            </thead>
            <tbody id="listBody"></tbody>
        </table>
    `;

    const listBody = document.getElementById("listBody");

// If NO records found ‚Üí show message
if (!records || records.length === 0) {
    listBody.innerHTML = `
        <tr>
            <td colspan="8" 
                style="
                    padding: 25px;
                    text-align: center;
                    font-size: 18px;
                    color: #888;
                    font-weight: 500;
                ">
                ‚ùå No Records Found
            </td>
        </tr>
    `;
    return;
}
console.log("Index records[0]:", records[0]);
    listBody.innerHTML = records
    .map((r, i) => `
        <tr class="list-row" onclick='openRecordDetails(event, ${JSON.stringify(r).replace(/'/g,"&apos;")})' style="border-bottom:1px solid #eee; animation-delay: ${i * 0.05}s">
            <td style="padding:10px;border:1px solid #ddd;text-align:center;">
                <img src="https://upload.wikimedia.org/wikipedia/en/f/ff/Andhra_Pradesh_Power_Generation_Company_Limited.jpg"
                     style="height:40px;border-radius:4px;">
            </td>
            <td style="padding:10px;border:1px solid #ddd;">${r.workName}</td>
            <td style="padding:10px;border:1px solid #ddd;text-align:center;">${r.prNo}</td>
            <td style="padding:10px;border:1px solid #ddd;text-align:center;">${r.subDivision}</td>
            <td style="padding:10px;border:1px solid #ddd;text-align:center;">${r.recordType}</td>
            <td style="padding:10px;font-weight:bold;color:green;border:1px solid #ddd;text-align:center;">
                ‚Çπ ${(parseFloat(r.amount) || 0).toLocaleString('en-IN')}
            </td>
            <td style="padding:10px;border:1px solid #ddd;text-align:center;">${r.sendTo}</td>
       <td style="padding:10px;border:1px solid #ddd;text-align:center;">
  ${statusBadge(r.status)}
</td>


            <!-- ‚≠ê VIEW PDF BUTTON ‚≠ê -->
            <td style="padding:10px;text-align:center;">
                <button 
                    onclick='showPDF(${JSON.stringify(r).replace(/'/g,"&apos;")})'
                    style="
                        background:#007bff;
                        color:white;
                        border:none;
                        padding:6px 12px;
                        border-radius:6px;
                        cursor:pointer;
                        font-weight:bold;
                    ">
                    View PDF
                </button>
            </td>
        </tr>
    `).join("");

    return;
}

   // ========= üü© CARD VIEW MODE (default) =========
container.style.display = "grid";

// If NO records ‚Üí show message
if (!records || records.length === 0) {
    container.innerHTML = `
        <div style="
            grid-column: 1 / -1;
            text-align: center;
            padding: 40px;
            font-size: 20px;
            font-weight: 500;
            color: #777;
        ">
            ‚ùå No Records Found
        </div>
    `;
    return;
}

container.innerHTML = records.map((r, i) => {
    const recordData = JSON.stringify(r).replace(/'/g, "&apos;");
    return `
      <div class="product" role="article" onclick='openRecordDetails(event, ${recordData})' style="animation-delay:${i * 0.05}s">
        <img src="https://upload.wikimedia.org/wikipedia/en/f/ff/Andhra_Pradesh_Power_Generation_Company_Limited.jpg"
             alt="APGENCO logo" />
        <div class="product-info">
          <h3>${summarize(r.workName)}</h3>
          <p><strong>PR No:</strong> ${r.prNo || 'N/A'}</p>
          <p><strong>Sub Div:</strong> ${r.subDivision || 'N/A'}</p>
          <p><strong>Type:</strong> ${r.recordType || 'N/A'}</p>
        </div>
        <button class="view-btn" onclick="handlePDFClick(event, ${recordData})">
    View PDF
</button>
      </div>
    `;
}).join("");
    }
   function statusBadge(status) {
  const colors = {
    "PR Created": "#6c757d",
    "Sent to Dy.EE": "#fd7e14",
    "Approved by Dy.EE": "#0d6efd",
    "Approved by EE": "#198754",
    "Returned": "#dc3545"
  };

  const safeStatus = status || "Pending";

  return `
    <span style="
      color:white;
      padding:4px 8px;
      border-radius:6px;
      font-size:12px;
      background:${colors[safeStatus] || '#6c757d'};
    ">
      ${safeStatus}
    </span>
  `;
}

//search function
    document.getElementById("searchInput").addEventListener("input", (e) => {
    const key = e.target.value.toLowerCase();

    /* ---------------------
       1Ô∏è‚É£ PDF SEARCH
    ----------------------*/
    if (pdfView.style.display !== "none") {
        const filtered = allRecords.filter(r =>
            (r.workName || "").toLowerCase().includes(key) ||
            (r.prNo || "").toLowerCase().includes(key) ||
            (r.sendTo || "").toLowerCase().includes(key)
        );
        renderRecords(filtered);
    }

/* ---------------------
       2Ô∏è‚É£ DAILY PROGRESS SEARCH (DATES)
    ----------------------*/
    if (progressView.style.display !== "none") {
        const allButtons = document.querySelectorAll(".date-list-item");
        allButtons.forEach(btn => {
            const txt = btn.textContent.toLowerCase();
            btn.style.display = txt.includes(key) ? "block" : "none";
        });
    }

    /* ---------------------
       3Ô∏è‚É£ CL BIO SEARCH
    ----------------------*/
  if (clbiodata.style.display !== "none") {
    const cards = document.querySelectorAll("#clBioGrid .cl-card");

    cards.forEach(card => {
        const info = card.innerText.toLowerCase();  // better than textContent
        card.style.display = info.includes(key) ? "block" : "none";
    });
}

      if (estimatesContainer.style.display !== "none") {
    

    const filtered = allEstimates.filter(r =>
        (r.description || "").toLowerCase().includes(key) ||
        (r.prNo || "").toLowerCase().includes(key) ||
        (r.estimateNo || "").toLowerCase().includes(key) ||
        (r.division || "").toLowerCase().includes(key)
    );

    renderEstimates(filtered);
}
});

let allEstimates = [];    
async function loadEstimates() {
    try {

        const res = await fetch(`${SERVER_URL}/estimates`);
        const data = await res.json();

        allEstimates = data;

        buildEstimateFilters();
        renderEstimates(allEstimates);

    } catch (err) {
        console.error("Estimates Load Error:", err);
        document.getElementById("estimatesGrid").innerHTML =
            "<p style='color:red;padding:20px;'>Failed to load estimates</p>";
  } finally {
        document.getElementById("est-loader").style.display = "none"; // ‚úÖ FIX
    }
}
    
function buildEstimateFilters() {
    const bar = document.getElementById("estimates-leftbar");

    bar.innerHTML = `
        <h3>Filter Estimates</h3>
        <button class="pdf-nav-btn show-all active" onclick="showAllEstimates(this)">üìÇ Show All</button>
    `;

    const divisions = [...new Set(allEstimates.map(x => x.division).filter(Boolean))];

    divisions.forEach(div => {
        bar.innerHTML += `
        <div class="pdf-nav-section">
            <button class="pdf-nav-header" onclick="togglePdfNav(this, event)">
                ${div}
            </button>

            <div class="pdf-nav-content">
                <button onclick="filterEstimates('${div}')">All in ${div}</button>
            </div>
        </div>
        `;
    });
}



function renderEstimates(data) {
    const container = document.getElementById("estimatesGrid");
    const listEnabled = localStorage.getItem("listView") === "true";

    document.getElementById("est-loader").style.display = "none";

    if (!data || data.length === 0) {
        container.innerHTML = `
        <div style="grid-column:1/-1; text-align:center; padding:40px; font-size:18px; color:#777;">
            No Estimate Records Found
        </div>`;
        return;
    }

    // ---------------- LIST VIEW ----------------
    if (listEnabled) {
    container.style.display = "block";

    container.innerHTML = `
    <table class="table-animate estimate-table">
        <thead>
            <tr>
                <th>S.No</th>
                <th>Work Name</th>
                <th>Division</th>
                <th>PR No</th>
                <th>Amount</th>
                <th>Send To</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="estListBody"></tbody>
    </table>`;

    const body = document.getElementById("estListBody");

    body.innerHTML = data.map((r, idx) => `
        <tr class="list-row"
    onclick='openRecordDetails(event, ${JSON.stringify(r).replace(/'/g,"&apos;")})'>
            <td>${idx + 1}</td>
            <td>${r.description || ""}</td>
            <td>${r.division || ""}</td>
            <td>${r.prNo || ""}</td>
            <td class="amount">‚Çπ ${(parseFloat(r.amount) || 0).toLocaleString('en-IN')}</td>
            <td>${r.sendTo || "-"}</td>
            <td style="text-align:center;">
  ${statusBadge(r.status)}
</td>
            <td>
                <button class="view-btn" onclick='showPDF(${JSON.stringify(r).replace(/'/g,"&apos;")})'>View PDF</button>
            </td>
        </tr>
    `).join("");

    return;
}


    // ---------------- CARD VIEW ----------------
    container.style.display = "grid";

    container.innerHTML = data.map((r,i) => {
        const rec = JSON.stringify(r).replace(/'/g,"&apos;");
        return `
        <div class="product" onclick='openRecordDetails(event, ${rec})' style="animation-delay:${i * 0.05}s">
            <img src="https://upload.wikimedia.org/wikipedia/en/f/ff/Andhra_Pradesh_Power_Generation_Company_Limited.jpg"/>

            <div class="product-info">
                <h3>${r.description}</h3>
                <p><strong>PR No:</strong> ${r.prNo}</p>
                <p><strong>Division:</strong> ${r.division}</p>
                <p><strong>Amount:</strong> ‚Çπ ${(parseFloat(r.amount) || 0).toLocaleString('en-IN')}</p>
                <p><strong>Status:</strong> ${statusBadge(r.status)}</p>
            </div>
${userRole !== "viewer" ? `
<button onclick='openRemarks("${r.prNo}")'>üìù</button>
` : ""}
            <button class="view-btn" onclick="handlePDFClick(event, ${rec})">View PDF</button>
        </div>`;
    }).join("");
}

/* ---------------- SHOW ALL ESTIMATES ---------------- */
function showAllEstimates(btn) {

    document.getElementById("estHeader").textContent = "üìò All Stage-V Estimates";

    collapseAllDropdowns("estimates-leftbar");   // NEW

    if (btn) btn.classList.add("active");

    renderEstimates(allEstimates);
}

async function uploadFile() {
  const fileInput = document.getElementById("fileInput");
  const file = fileInput.files[0];

  if (!file) {
    alert("Select a file first");
    return;
  }

  const token = localStorage.getItem("adminToken");

  // ‚ùå Not logged in ‚Üí open password modal
  if (!token) {
    pendingUpload = true;          // remember intent
    openPasswordModal();           // reuse existing modal
    return;
  }

  // ‚úÖ Logged in ‚Üí upload
  const fd = new FormData();
  fd.append("file", file);

  const res = await fetch(`${SERVER_URL}/file-transfer/upload`, {
    method: "POST",
    headers: {
      Authorization: `Bearer ${token}`
    },
    body: fd
  });

  if (!res.ok) {
    alert("Upload failed");
    return;
  }

  fileInput.value = "";   // reset input
  loadFiles();
}



function isLoggedIn() {
  return !!localStorage.getItem("adminToken");
}
let pendingDownloadUrl = null;

function handleFileDownload(url) {
  if (!isLoggedIn()) {
    pendingDownloadUrl = url;
    openPasswordModal();
    return;
  }
  triggerDownload(url);
}

function triggerDownload(url) {
  const a = document.createElement("a");
  a.href = url;
  a.download = "";
  document.body.appendChild(a);
  a.click();
  a.remove();
}

async function loadFiles() {
  try {
    const res = await fetch(`${SERVER_URL}/file-transfer`);

    if (!res.ok) {
      console.error("File-transfer API failed:", res.status);
      return;
    }

    const files = await res.json();

    document.getElementById("fileList").innerHTML = files.map(f => `
      <tr>
        <td>${f.file_name}</td>
        <td>${(f.file_size / 1024).toFixed(1)} KB</td>
        <td>${new Date(f.uploaded_at).toLocaleString()}</td>
        <td>${new Date(f.expires_at).toLocaleString()}</td>
        <td>
          <button class="view-btn" onclick="handleFileDownload('${f.file_url}')">
            ‚¨á Download
          </button>
        </td>
        <td>
  <button class="view-btn" onclick="handleFileDownload('${f.file_url}')">
    ‚¨á Download
  </button>

  ${localStorage.getItem("adminToken") ? `
    <button class="view-btn" style="background:#dc3545"
      onclick="deleteFile(${f.id})">
      üóë Delete
    </button>` : ""}
</td>

      </tr>
    `).join("");

  } catch (err) {
    console.error("loadFiles failed:", err);
  }
}

function updateFileLoginStatus() {
  const el = document.getElementById("fileLoginStatus");
  const token = localStorage.getItem("adminToken");

  if (token) {
    el.innerHTML = "üü¢ Logged in";
  } else {
    el.innerHTML = "üîí Login required for download";
    el.style.color = "#dc3545";
  }
}
async function deleteFile(id) {
  if (!confirm("Delete this file permanently?")) return;

  const token = localStorage.getItem("adminToken");

  const res = await fetch(`${SERVER_URL}/file-transfer/${id}`, {
    method: "DELETE",
    headers: {
      Authorization: `Bearer ${token}`
    }
  });

  if (res.ok) {
    alert("File deleted");
    loadFiles();
  } else {
    alert("Delete failed");
  }
}

/* ---------------- FILTER ESTIMATES ---------------- */
function filterEstimates(div) {
    const filtered = allEstimates.filter(r => r.division === div);

    // Set header FIRST before rendering happens
    setTimeout(() => {
        document.getElementById("estHeader").textContent = `üìò All ${div} Estimates`;
    }, 10);

    renderEstimates(filtered);
}

window.openRecordDetails = function(event, record) {
    // Prevent clicks on buttons inside card/row
    if (event.target.closest("button")) return;

    showDetails(record);  // ‚Üê Already created modal function
};
window.showDetails = function (record) {

    const grid = document.getElementById("detailsGrid");
    grid.innerHTML = "";

    const fields = [
        ["ID", record.id],
        ["Work Name", record.workName || record.description],
        ["PR Number", record.prNo],
        ["Sub Division", record.subDivision || record.division],
        ["Record Type", record.recordType],
        ["Status", record.status],
        ["Amount", record.amount ? `‚Çπ ${parseFloat(record.amount).toLocaleString("en-IN")}` : "‚Äî"],
        ["Send To", record.sendTo],
        ["PDF File", record.pdfPath ? "View PDF" : "No PDF"],
        ["PR Date", record.prDate],
        ["Budget Head", record.budgetHead],
        ["PO Number", record.poNo]
    ];

    fields.forEach(([label, value]) => {
        let display = value ?? "‚Äî";

        if (label === "PDF File" && record.pdfPath) {
            display = `
    <a href="javascript:void(0)"
       style="color:#007bff;font-weight:bold"
       onclick='openPdfFromDetails(${JSON.stringify(record).replace(/'/g, "&apos;")})'>
       View PDF
    </a>`;
        }

        grid.innerHTML += `
            <div>
                <b>${label}</b>
                <p>${display}</p>
            </div>
        `;
    });

    // show modal (ONLY ONCE, INSIDE FUNCTION)
    document.getElementById("recordDetailsModal").classList.add("active");
};
function openPdfFromDetails(record) {
    // Close record details modal first
    document.getElementById("recordDetailsModal").classList.remove("active");

    // Small delay for smooth UX
    setTimeout(() => {
        showPDF(record);
    }, 120);
}


function closeRecordDetails() {
    document.getElementById("recordDetailsModal").classList.remove("active");
}

    window.handlePDFClick = function(event, record) {
    event.stopPropagation();  // <-- stops card click
    showPDF(record);          // <-- opens only PDF
};

function printRecordDetails() {
  // clone only the inner box so we don't print overlay background/buttons
  const box = document
    .querySelector("#recordDetailsModal .details-box")
    .cloneNode(true);

  // remove close & print buttons from print version
  box.querySelector(".close-details")?.remove();
  box.querySelector(".details-print-btn")?.remove();

  const win = window.open("", "PRINT", "height=900,width=700");

  win.document.write(`
    <html>
    <head>
      <title>Record Details</title>
      <style>
        @page {
          size: A4;
          margin: 15mm;
        }

        body {
          font-family: "Segoe UI", Arial, sans-serif;
          font-size: 13px;
          color: #222;
        }

        .details-box {
          box-shadow: none;
          border: none;
          padding: 0;
          max-width: 100%;
        }

        h2.details-title {
          text-align: center;
          margin: 0 0 16px 0;
          font-size: 18px;
          text-transform: uppercase;
          letter-spacing: 0.04em;
        }

        .details-grid {
          display: grid;
          grid-template-columns: repeat(2, 1fr);
          grid-column-gap: 18px;
          grid-row-gap: 10px;
        }

        .details-grid div {
          break-inside: avoid;
        }

        .details-grid div b {
          display: block;
          font-size: 11px;
          color: #555;
          margin-bottom: 2px;
        }

        .details-grid div p {
          margin: 0;
          padding: 6px 8px;
          border-radius: 4px;
          background: #f5f7fb;
          border: 1px solid #dde2ee;
          font-size: 12px;
        }

        a {
          color: #007bff;
          text-decoration: none;
          word-break: break-all;
        }

        /* Optional: show pdf link URL in brackets after text */
        a::after {
          content: " (" attr(href) ")";
          font-size: 10px;
        }

        @media print {
          .no-print {
            display: none !important;
          }
        }
      </style>
    </head>
    <body>
      ${box.outerHTML}
    </body>
    </html>
  `);

  win.document.close();
  win.focus();
  setTimeout(() => {
    win.print();
    win.close();
  }, 200);
}

function buildDynamicDivisionFilters() {
    const sidebar = document.getElementById("pdf-nav-bar");

    // Reset sidebar
    sidebar.innerHTML = `
        <h3>Filter Indents</h3>
        <button class="pdf-nav-btn show-all active" onclick="showAllPDFs(this)">üìÇ Show All</button>
    `;

    // Get unique divisions (skip null/blank)
    const divisions = [...new Set(
        allRecords
            .map(r => r.subDivision)
            .filter(x => x && x.trim() !== "")
    )];

    divisions.forEach(div => {
        const section = document.createElement("div");
        section.classList.add("pdf-nav-section");

        section.innerHTML = `
            <button class="pdf-nav-header" onclick="togglePdfNav(this, event)">${div}</button>

            <div class="pdf-nav-content">
                <button onclick="filterRecords('${div}', 'PR', this)">PRs</button>
                <button onclick="filterRecords('${div}', 'Drawing', this)">Drawings</button>
                <button onclick="filterRecords('${div}', 'Other Record', this)">Other Records</button>
            </div>
        `;
        sidebar.appendChild(section);
    });
}

function openAddRecordFromDetails() {
    // 1Ô∏è‚É£ Close record details modal
    document.getElementById("recordDetailsModal").classList.remove("active");

    // 2Ô∏è‚É£ Small delay for smooth transition
    setTimeout(() => {
        openPasswordModal();
    }, 150);
}


    
function toggleSearchBar() {
    const input = document.getElementById("searchInput");
    input.classList.toggle("active");

    if (input.classList.contains("active")) {
        input.focus();
    }
}
    
    // PDF modal logic (redesigned close etc)
    const productModal = document.getElementById('productModal');
    const modalName = document.getElementById('modalName');
    const modalPR = document.getElementById('modalPR');
    const pdfFrame = document.getElementById('pdfFrame');
    const closeModalBtn = document.getElementById('closeModal');
    const modalToolbar = document.getElementById('modalToolbar');
    const openInNewBtn = document.getElementById('openInNewBtn');
    const downloadBtn = document.getElementById('downloadBtn');

    window.showPDF = function(record){
  const { pdfPath, workName, prNo } = record || {};
  if (!pdfPath) return alert("No PDF associated with this record.");

  let finalUrl;

  // üëâ CASE 1: Supabase URL (starts with http)
  if (pdfPath.startsWith("http")) {
    finalUrl = pdfPath;
  }
  // üëâ CASE 2: File stored on backend
  else {
    let path = pdfPath;
    if (!path.startsWith("/uploads/")) {
      path = "/uploads/" + path.replace(/^uploads[\\/]/, "");
    }
    finalUrl = `${SERVER_URL}${path}`;
  }

  modalName.textContent = workName || 'PDF';
  modalPR.textContent = "PR No: " + (prNo || 'N/A');

  // Load PDF
  pdfFrame.src = finalUrl;

  productModal.classList.add('active');
  productModal.setAttribute('aria-hidden','false');
  document.body.style.overflow = 'hidden';

  // Buttons
  openInNewBtn.onclick = ()=> window.open(finalUrl, "_blank");
  downloadBtn.onclick = ()=> {
    const a = document.createElement("a");
    a.href = finalUrl;
    a.download = (prNo || "document") + ".pdf";
    document.body.appendChild(a);
    a.click();
    a.remove();
  };

  // Mobile toolbar visibility
  if (window.innerWidth <= 768) {
    modalToolbar.style.display = "flex";
    document.querySelector(".drag-handle").style.display = "block";
  } else {
    modalToolbar.style.display = "none";
    document.querySelector(".drag-handle").style.display = "none";
  }
};

let activePR = "";

function openRemarks(prNo) {
  activePR = prNo;
  fetch(`${SERVER_URL}/api/remarks/${prNo}`)
    .then(r => r.json())
    .then(data => {
      document.getElementById("remarksList").innerHTML =
        data.map(r => `<p><b>${r.by}</b>: ${r.text}</p>`).join("");
      document.getElementById("remarksModal").style.display = "block";
    });
}

function closeRemarks() {
  document.getElementById("remarksModal").style.display = "none";
}

function saveRemark() {
fetch(`${SERVER_URL}/api/remarks`, {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ pr_no: activePR, text: document.getElementById("newRemark").value })
  }).then(() => openRemarks(activePR));
}

    function closeModal(){
      productModal.classList.remove('active');
      productModal.setAttribute('aria-hidden','true');
      pdfFrame.src = 'about:blank';
      document.body.style.overflow = 'auto';
    }
    closeModalBtn.addEventListener('click', closeModal);

    // clicking outside modal content closes on mobile for easier UX
    productModal.addEventListener('click', (e)=>{
      if(window.innerWidth <= 768){
        if(e.target === productModal) closeModal();
      }
    });

    // daily progress code (unchanged logic)
    async function loadDailyProgressDates(){
      const dateList = document.getElementById('inlineDateList');
      try {
        const res = await fetch(`${SERVER_URL}/daily-progress`);
        const snapshots = await res.json();
        if(!snapshots.length){ dateList.innerHTML = "<p>No snapshots found.</p>"; return; }
        snapshots.sort((a,b)=> (b.date||'').localeCompare(a.date));
        dateList.innerHTML = snapshots.map(s=>`<button class="date-list-item" onclick="loadInlineSnapshot(${s.id}, '${s.date}', this)">${s.date} (${s.rowCount} rows)</button>`).join('');
      } catch(e){
        console.error("Failed to load snapshots:", e);
        dateList.innerHTML = "<p style='color:red'>Error loading dates.</p>";
      }
    }

    window.loadInlineSnapshot = async function(id, dateStr, btn){
      const title = document.getElementById('inlineSnapshotTitle');
      const frame = document.getElementById('inlineSnapshotFrame');
      const printBtn = document.getElementById('inlinePrintBtn');

      document.querySelectorAll('.date-list-item').forEach(b=>b.classList.remove('active'));
      if(btn) btn.classList.add('active');

      title.textContent = 'Loading...';
      frame.innerHTML = "<p>Loading snapshot...</p>";
      printBtn.style.display = 'none';

      try {
        const res = await fetch(`${SERVER_URL}/daily-progress/${id}`);
        if(!res.ok) throw new Error('Snapshot not found');
        const snapshot = await res.json();

        const thead = `<tr>
          <th style="width:120px">Date</th><th style="width:120px">Division</th>
          <th style="width:160px">Sub-Division/Location</th><th style="min-width:500px">Maintenance Activity Description</th>
          <th style="width:140px">Man Power Engaged</th><th style="width:140px">Status</th><th style="min-width:200px">Remarks/Issues</th>
        </tr>`;

        title.textContent = `Daily Progress on: ${snapshot.date}`;
        frame.innerHTML = `<table id="previewTable"><thead>${thead}</thead><tbody>${snapshot.tableHTML}</tbody></table>`;
        printBtn.style.display = 'block';

        // minor cleaning (same as before)
        const rows = frame.querySelectorAll('#previewTable tbody tr');
        let prevDate = null;
        rows.forEach(tr=>{
          const dateCell = tr.children[0];
          const divisionCell = tr.children[1];
          if(dateCell){
            const cur = dateCell.textContent;
            if(cur === prevDate && divisionCell && divisionCell.textContent.trim()==='') dateCell.textContent = '';
            else if(cur.trim() !== '') prevDate = cur;
          }
          if(tr.lastElementChild) tr.removeChild(tr.lastElementChild);
        });
        frame.querySelectorAll('#previewTable td[contenteditable="true"]').forEach(td=>{
          td.removeAttribute('contenteditable');
          td.style.background = 'none';
        });
        
        // close the left pane on mobile so user sees the table
        if(window.innerWidth <= 768){
          document.getElementById('inlineLeftBar')?.classList?.remove('active');
        }
      } catch(err){
        console.error(err);
        title.textContent = 'Error';
        frame.innerHTML = `<p style='color:red;'>Error loading snapshot: ${err.message}</p>`;
      }
    };

    window.printDailyProgress = function(){
      const content = document.getElementById('inlineSnapshotFrame').innerHTML;
      const title = document.getElementById('inlineSnapshotTitle').textContent;
      const w = window.open('','print','height=800,width=1000');
      w.document.write('<html><head><title>Print Snapshot</title>');
      w.document.write(`<style>body{font-family:Arial}table{width:100%;border-collapse:collapse}th,td{border:1px solid #000;padding:8px;text-align:left}</style>`);
      w.document.write('</head><body>');
      w.document.write(`<h3>${title}</h3>`);
      w.document.write(content);
      w.document.write('</body></html>');
      w.document.close();
      w.focus();
      setTimeout(()=>{ w.print(); w.close(); },250);
    };

// =========================================
// REAL CL BIO DATA FETCH + CARD RENDER
// =========================================

const goTopBtn = document.getElementById("goTopBtn");
const goBottomBtn = document.getElementById("goBottomBtn");

window.addEventListener("scroll", () => {

    const scrollY = window.scrollY;
    const maxScroll = document.documentElement.scrollHeight - window.innerHeight;

    // Show Back-to-top when user scrolls down 250px
    goTopBtn.style.display = scrollY > 250 ? "block" : "none";

    // Show "Go Bottom" only if not near the bottom
    goBottomBtn.style.display = scrollY < maxScroll - 250 ? "block" : "none";
});

// Scroll to top
goTopBtn.onclick = () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
};

// Scroll to bottom
goBottomBtn.onclick = () => {
    window.scrollTo({ 
        top: document.documentElement.scrollHeight, 
        behavior: "smooth" 
    });
};



    
async function renderCLBioData() {
  const container = document.getElementById("clBioGrid");
  container.innerHTML = "<p>Loading CL data...</p>";

  try {
    const res = await fetch(`${SERVER_URL}/cl`);
    const data = await res.json();

    if (!data.length) {
      container.innerHTML = "<p>No CL Bio Data found.</p>";
      return;
    }

   container.innerHTML = data
  .map(c => {
    const photo = c.photo_url 
      ? c.photo_url 
      : "https://icon-library.com/images/no-picture-available-icon/no-picture-available-icon-20.jpg";

    return `
      <div class="cl-card">

        <img src="${photo}" class="cl-photo">

        <div class="cl-name">${c.name}</div>

        <div class="cl-info-box">

          <p><b>Gender:</b> ${c.gender}</p>
          <p><b>Aadhar:</b> ${c.aadhar}</p>
          <p><b>Phone:</b> ${c.phone || "N/A"}</p>

          <p><b>Station:</b> ${c.station}</p>
          <p><b>Division:</b> ${c.division}</p>

          <p><b>Date of Joining:</b> ${c.doj}</p>
          <p><b>Date of Birth:</b> ${c.dob}</p>

          <p><b>Wages:</b> ${c.wages}</p>
          <p><b>Nominee:</b> ${c.nominee} (${c.relation})</p>

        </div>
      </div>
    `;
  })
  .join("");

  } catch (err) {
    console.error(err);
    container.innerHTML = "<p style='color:red'>Error fetching CL Bio Data.</p>";
  }
}

    
    // password modal helpers
    window.openPasswordModal = function(){ document.getElementById('passwordModal').style.display='flex'; document.getElementById('usernameInput').focus(); }
    window.closePasswordModal = function(){ document.getElementById('passwordModal').style.display='none'; document.getElementById('usernameInput').value=''; document.getElementById('passwordInput').value=''; }
    document.getElementById('passwordInput').addEventListener('keydown', function(e){ if(e.key === 'Enter'){ e.preventDefault(); verifyPassword(); }})

    window.verifyPassword = async function(){
  const username = document.getElementById('usernameInput').value.trim();
  const pass = document.getElementById('passwordInput').value.trim();

  if(!username || !pass){ 
    alert('Please enter a username and password.'); 
    return; 
  }

  try{
    const res = await fetch(`${SERVER_URL}/login`, {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ email: username, password: pass })
    });

    if (res.ok) {
  const data = await res.json();

  localStorage.setItem("adminToken", data.token);
  localStorage.setItem("isAdmin", "true");

  closePasswordModal();

  // ‚úÖ If upload was pending, continue upload
  if (pendingUpload) {
    pendingUpload = false;
    uploadFile();
  }
}
 else {
      const err = await res.json();
      alert('‚ùå ' + (err.message || 'Incorrect email or password!'));
    }

  } catch(e){
    console.error('Login error', e);
    alert('‚ö†Ô∏è Could not connect to the login server.');
  }
};


    // Mobile sidebar toggles (slide-in from LEFT)
    function toggleSidebar(buttonId, sidebarId){
      const btn = document.getElementById(buttonId);
      const sidebar = document.getElementById(sidebarId);
      if(!btn || !sidebar) return;
      btn.addEventListener('click', (ev)=>{
        ev.stopPropagation();
        // toggle active class which moves sidebar in
        const active = sidebar.classList.toggle('active');
        // for accessibility aria-hidden
        sidebar.setAttribute('aria-hidden', (!active).toString());
      });
      // click outside closes
      document.addEventListener('click', (e)=>{
        if(!sidebar.classList.contains('active')) return;
        if(sidebar.contains(e.target) || btn.contains(e.target)) return;
        sidebar.classList.remove('active');
        sidebar.setAttribute('aria-hidden','true');
      });
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      toggleSidebar('mobileFilterBtn','pdf-nav-bar');
      toggleSidebar('mobileEstFilterBtn','estimates-leftbar'); // Estimates
      toggleSidebar('mobileDailyFilterBtn','inlineLeftBar');
    });
    
//dropdown
window.toggleMenu = function () {
    const menu = document.getElementById("dropdownMenu");

    if (window.innerWidth <= 768) {
        // MOBILE ‚Üí slide menu
        menu.classList.toggle("active");
    } else {
        // DESKTOP ‚Üí simple show/hide
        menu.style.display = menu.style.display === "flex" ? "none" : "flex";
    }
};



    // Scroll to top behaviour
    const scrollTopBtn = document.getElementById('scrollTopBtn');
    const rightPanels = document.querySelectorAll('.right-panel');
    rightPanels.forEach(p=>{
      p.onscroll = ()=> { scrollTopBtn.style.display = p.scrollTop > 240 ? 'block' : 'none'; }
    });
    scrollTopBtn.addEventListener('click', ()=>{
      document.getElementById('pdf-grid-wrapper').scrollTo({ top: 0, behavior: 'smooth' });
      document.getElementById('inlineRightBar')?.scrollTo({ top: 0, behavior: 'smooth' });
    });



function applyUserSettings() {
    const dark = localStorage.getItem("darkMode") === "true";

    if (dark) {
        document.body.classList.add("dark-mode");
        document.querySelector("header").classList.add("dark-mode");
        document.getElementById("dropdownMenu").classList.add("dark-mode");

        document.querySelectorAll(".left-bar").forEach(el => el.classList.add("dark-mode"));
        document.querySelectorAll(".product").forEach(el => el.classList.add("dark-mode"));
        document.querySelectorAll(".product-info h3").forEach(el => el.style.color = "#fff");
        document.querySelectorAll(".product-info p").forEach(el => el.style.color = "#ddd");
    }

    // CARD SIZE
    const size = localStorage.getItem("cardSize") || "normal";
    let scale = 1;
    if (size === "small") scale = 0.85;
    if (size === "large") scale = 1.15;
    document.documentElement.style.setProperty("--card-scale", scale);

    document.querySelectorAll(".product").forEach(card => {
        card.style.transform = `scale(${scale})`;
    });

    // GRID COLUMNS
    const cols = localStorage.getItem("gridColumns") || "3";
    const grid = document.querySelector(".product-grid");
    if (grid) {
        grid.style.gridTemplateColumns = `repeat(${cols}, minmax(240px, 1fr))`;
    }

    // ANIMATIONS
    const anim = localStorage.getItem("enableAnim") === "true";
    if (!anim) {
        document.querySelectorAll("*").forEach(e => e.style.animation = "none");
    }
}  

document.addEventListener("click", (e) => {
    const row = e.target.closest(".list-row");
    if (row) {
        row.classList.remove("row-clicked");
        void row.offsetWidth; // restart animation
        row.classList.add("row-clicked");
    }
});
function scrollToTop() {
    document.documentElement.scrollTop = 0;
    document.body.scrollTop = 0;

    document.querySelectorAll('.right-panel').forEach(panel => {
        panel.scrollTo({ top: 0 });
    });
}


// ESC KEY ‚Üí close modal + sidebars
window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeModal();
        document.querySelectorAll('.left-bar.active').forEach(el => el.classList.remove('active'));
    }
});
// Visit Counter
function updateVisitCounter() {
    let count = localStorage.getItem("siteVisits");

    if (!count) count = 0;
    count = parseInt(count) + 1;

    localStorage.setItem("siteVisits", count);

    document.getElementById("visitCounter").textContent = `Visits: ${count}`;
}

updateVisitCounter();

// PAGE LOAD INIT
window.addEventListener("load", () => {
    applyUserSettings();
    loadDailyProgressDates();
    loadRecords();
  loadEstimates();
});
window.addEventListener("DOMContentLoaded", function () {
    showMainView("pdf");   // Forces All Indents to open first
});
  </script>
</body>
</html>







